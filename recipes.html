<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Recipes &#8212; roswire 2.0.0 documentation</title>
    <link rel="stylesheet" href="_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="roswire" href="index.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<link href="_static/solarized-dark.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="roswire"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">roswire 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p>
<iframe src="https://ghbtns.com/github-btn.html?user=ChrisTimperley&amp;repo=roswire&amp;type=star&amp;count=true&amp;size=large&amp;v=2" allowtransparency="true" scrolling="0" width="200px" height="35px" frameborder="0"></iframe>
</p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">roswire</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#contents">Contents</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#list-all-ros-packages-within-a-docker-image">List all ROS packages within a Docker image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#produce-a-description-of-a-given-ros-package">Produce a description of a given ROS package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#call-a-ros-service">Call a ROS service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#apply-a-source-code-patch-and-rebuild-the-application">Apply a source code patch and rebuild the application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#record-ros-topic-data-to-a-ros-bag">Record ROS topic data to a ROS bag</a></li>
<li class="toctree-l2"><a class="reference internal" href="#observe-the-state-of-a-running-ros-system">Observe the state of a running ROS system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="recipes">
<h1>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h1>
<p>This section of the documentation provides several recipes for using ROSWire.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you would like to see a recipe here, then go ahead and request a recipe by
submitting an issue to the GitHub issue tracker: <a class="reference external" href="https://github.com/ChrisTimperley/roswire/issues">https://github.com/ChrisTimperley/roswire/issues</a></p>
</div>
<div class="section" id="list-all-ros-packages-within-a-docker-image">
<h2>List all ROS packages within a Docker image<a class="headerlink" href="#list-all-ros-packages-within-a-docker-image" title="Permalink to this headline">¶</a></h2>
<p>The following example prints a list of the names of all of the ROS packages
that appear in a given Docker image.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">roswire</span>

<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/opt/ros/indigo/setup.bash&#39;</span><span class="p">,</span> <span class="s1">&#39;/ros_ws/devel/setup.bash&#39;</span><span class="p">]</span>
<span class="n">description</span> <span class="o">=</span> <span class="n">rsw</span><span class="o">.</span><span class="n">descriptions</span><span class="o">.</span><span class="n">load_or_build</span><span class="p">(</span><span class="s1">&#39;roswire/example:mavros&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">description</span><span class="o">.</span><span class="n">packages</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the example above produces the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">catkin</span>
<span class="n">genmsg</span>
<span class="n">gencpp</span>
<span class="n">genlisp</span>
<span class="n">genpy</span>
<span class="n">cmake_modules</span>
<span class="n">test_find_tinyxml</span>
<span class="n">class_loader</span>
<span class="n">cpp_common</span>
<span class="n">mavlink</span>
<span class="n">libmavconn</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="produce-a-description-of-a-given-ros-package">
<h2>Produce a description of a given ROS package<a class="headerlink" href="#produce-a-description-of-a-given-ros-package" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">roswire</span>

<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>

<span class="c1"># the list of sources that should be used to setup the catkin workspace</span>
<span class="c1"># in the example list of sources below, we first load the system&#39;s workspace</span>
<span class="c1"># (/opt/ros/indigo/setup.bash) before loading the setup script for the devel</span>
<span class="c1"># workspace in /ros_ws</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/opt/ros/indigo/setup.bash&quot;</span><span class="p">,</span> <span class="s2">&quot;/ros_ws/devel/setup.bash&quot;</span><span class="p">]</span>
<span class="n">description</span> <span class="o">=</span> <span class="n">rsw</span><span class="o">.</span><span class="n">descriptions</span><span class="o">.</span><span class="n">load_or_build</span><span class="p">(</span><span class="s2">&quot;roswire/example:mavros&quot;</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">packages</span><span class="p">[</span><span class="s2">&quot;tf2_msgs&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PACKAGE DETAILS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Messages: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Services: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">services</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actions: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the code snippet above produces the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PACKAGE</span> <span class="n">DETAILS</span>
<span class="o">--------------------------------------------------------------------------------</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">tf2_msgs</span>
<span class="n">Path</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ros</span><span class="o">/</span><span class="n">indigo</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">bond</span>
<span class="n">Messages</span><span class="p">:</span> <span class="n">TF2Error</span><span class="p">,</span> <span class="n">TFMessage</span>
<span class="n">Services</span><span class="p">:</span> <span class="n">FrameGraph</span>
<span class="n">Actions</span><span class="p">:</span> <span class="n">LookupTransform</span>
</pre></div>
</div>
</div>
<div class="section" id="call-a-ros-service">
<h2>Call a ROS service<a class="headerlink" href="#call-a-ros-service" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">roswire</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>

<span class="n">FN_SITL</span> <span class="o">=</span> <span class="s2">&quot;/ros_ws/src/ArduPilot/build/sitl/bin/arducopter&quot;</span>
<span class="n">FN_PARAMS</span> <span class="o">=</span> <span class="s2">&quot;/ros_ws/src/ArduPilot/copter.parm&quot;</span>

<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/opt/ros/indigo/setup.bash&quot;</span><span class="p">,</span> <span class="s2">&quot;/ros_ws/devel/setup.bash&quot;</span><span class="p">]</span>
<span class="k">with</span> <span class="n">rsw</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="s2">&quot;roswire/example:mavros&quot;</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span> <span class="k">as</span> <span class="n">system</span><span class="p">:</span>
    <span class="c1"># Fetch the dynamically generated types for the messages that we want to send</span>
    <span class="n">SetModeRequest</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="s2">&quot;mavros_msgs/SetModeRequest&quot;</span><span class="p">]</span>
    <span class="n">CommandBoolRequest</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="s2">&quot;mavros_msgs/CommandBoolRequest&quot;</span><span class="p">]</span>
    <span class="n">CommandTOLRequest</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="s2">&quot;mavros_msgs/CommandTOLRequest&quot;</span><span class="p">]</span>

    <span class="c1"># launch a temporary ROS session inside the app container</span>
    <span class="c1"># once the context is closed, the ROS session will be terminated and all</span>
    <span class="c1"># of its associated nodes will be automatically killed.</span>
    <span class="k">with</span> <span class="n">system</span><span class="o">.</span><span class="n">roscore</span><span class="p">()</span> <span class="k">as</span> <span class="n">ros</span><span class="p">:</span>
        <span class="c1"># for this example, we need to separately launch a software-in-the-loop</span>
        <span class="c1"># simulator for the robot platform</span>
        <span class="n">ps_sitl</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FN_SITL</span><span class="si">}</span><span class="s2"> --model copter --defaults </span><span class="si">{</span><span class="n">FN_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># use roslaunch to launch the application inside the ROS session</span>
        <span class="n">ros</span><span class="o">.</span><span class="n">roslaunch</span><span class="p">(</span>
            <span class="s2">&quot;apm.launch&quot;</span><span class="p">,</span>
            <span class="n">package</span><span class="o">=</span><span class="s2">&quot;mavros&quot;</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fcu_url&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp://127.0.0.1:5760@5760&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># let&#39;s wait some time for the copter to become armable</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

        <span class="c1"># arm the copter</span>
        <span class="n">request_arm</span> <span class="o">=</span> <span class="n">CommandBoolRequest</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">response_arm</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="s2">&quot;/mavros/cmd/arming&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">request_arm</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response_arm</span><span class="o">.</span><span class="n">success</span>

        <span class="c1"># switch to guided mode</span>
        <span class="n">request_guided</span> <span class="o">=</span> <span class="n">SetModeRequest</span><span class="p">(</span><span class="n">base_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">custom_mode</span><span class="o">=</span><span class="s2">&quot;GUIDED&quot;</span><span class="p">)</span>
        <span class="n">response_guided</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="s2">&quot;/mavros/set_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">request_guided</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response_arm</span><span class="o">.</span><span class="n">success</span>

        <span class="c1"># takeoff to 50 metres above the ground</span>
        <span class="n">request_takeoff</span> <span class="o">=</span> <span class="n">CommandTOLRequest</span><span class="p">(</span>
            <span class="n">min_pitch</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yaw</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">altitude</span><span class="o">=</span><span class="mf">50.0</span>
        <span class="p">)</span>
        <span class="n">response_takeoff</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="s2">&quot;/mavros/cmd/takeoff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
            <span class="n">request_takeoff</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">response_takeoff</span><span class="o">.</span><span class="n">success</span>

        <span class="c1"># wait for the copter to reach the target altitude</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;waiting for copter to reach altitude...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished waiting&quot;</span><span class="p">)</span>

        <span class="c1"># kill the simulator</span>
        <span class="n">ps_sitl</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="apply-a-source-code-patch-and-rebuild-the-application">
<h2>Apply a source code patch and rebuild the application<a class="headerlink" href="#apply-a-source-code-patch-and-rebuild-the-application" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">roswire</span>

<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.diff&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># we use &#39;launch&#39; to create a temporary container for the application</span>
<span class="c1"># when the context is closed, either by reaching the end of the with</span>
<span class="c1"># block or by abruptly encountering an exception, the container will be</span>
<span class="c1"># automatically destroyed.</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/opt/ros/indigo/setup.bash&#39;</span><span class="p">,</span> <span class="s1">&#39;/ros_ws/devel/setup.bash&#39;</span><span class="p">]</span>
<span class="k">with</span> <span class="n">rsw</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="s1">&#39;roswire/example:mavros&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span> <span class="k">as</span> <span class="n">system</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;applying patch...&quot;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="s1">&#39;/ros_ws/src/mavros/mavros/src/mavros_node.cpp&#39;</span>
    <span class="n">system</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;patch applied&quot;</span><span class="p">)</span>
    
    <span class="c1"># rebuild via catkin tools</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rebuilding...&quot;</span><span class="p">)</span>
    <span class="n">dir_workspace</span> <span class="o">=</span> <span class="s1">&#39;/ros_ws&#39;</span>
    <span class="n">catkin</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">catkin</span><span class="p">(</span><span class="n">dir_workspace</span><span class="p">)</span>
    <span class="n">catkin</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rebuilt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Below are the contents of <code class="code docutils literal notranslate"><span class="pre">example.diff</span></code>.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- mavros_node.cpp	2019-09-09 23:22:23.000000000 +0000</span>
<span class="gi">+++ mavros_node.cpp	2019-09-10 00:23:23.952098138 +0000</span>
<span class="gu">@@ -20,6 +20,6 @@</span>
 	mavros::MavRos mavros;
 	mavros.spin();
 
<span class="gd">-	return 0;</span>
<span class="gi">+	return 1;</span>
 }
 
</pre></div>
</div>
</div>
<div class="section" id="record-ros-topic-data-to-a-ros-bag">
<h2>Record ROS topic data to a ROS bag<a class="headerlink" href="#record-ros-topic-data-to-a-ros-bag" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">roswire</span>

<span class="n">FN_SITL</span> <span class="o">=</span> <span class="s1">&#39;/ros_ws/src/ArduPilot/build/sitl/bin/arducopter&#39;</span>
<span class="n">FN_PARAMS</span> <span class="o">=</span> <span class="s1">&#39;/ros_ws/src/ArduPilot/copter.parm&#39;</span>

<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>

<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/opt/ros/indigo/setup.bash&#39;</span><span class="p">,</span> <span class="s1">&#39;/ros_ws/devel/setup.bash&#39;</span><span class="p">]</span>
<span class="k">with</span> <span class="n">rsw</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="s1">&#39;roswire/example:mavros&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span> <span class="k">as</span> <span class="n">system</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">system</span><span class="o">.</span><span class="n">roscore</span><span class="p">()</span> <span class="k">as</span> <span class="n">ros</span><span class="p">:</span>
        <span class="c1"># for this example, we need to separately launch a software-in-the-loop</span>
        <span class="c1"># simulator for the robot platform</span>
        <span class="n">ps_sitl</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">FN_SITL</span><span class="si">}</span><span class="s1"> --model copter --defaults </span><span class="si">{</span><span class="n">FN_PARAMS</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># use roslaunch to launch the application inside the ROS session</span>
        <span class="n">ros</span><span class="o">.</span><span class="n">roslaunch</span><span class="p">(</span><span class="s1">&#39;apm.launch&#39;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s1">&#39;mavros&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fcu_url&#39;</span><span class="p">:</span> <span class="s1">&#39;tcp://127.0.0.1:5760@5760&#39;</span><span class="p">})</span>

        <span class="c1"># to record all ROS topic data for 300 seconds</span>
        <span class="k">with</span> <span class="n">ros</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s1">&#39;filepath-on-host-machine.bag&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">recorder</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

        <span class="c1"># alternatively, we can use a recorder directly</span>
        <span class="n">recorder</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s1">&#39;filepath-on-host-machine2.bag&#39;</span><span class="p">)</span>
        <span class="n">recorder</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">recorder</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="observe-the-state-of-a-running-ros-system">
<h2>Observe the state of a running ROS system<a class="headerlink" href="#observe-the-state-of-a-running-ros-system" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="kn">import</span> <span class="nn">roswire</span>

<span class="c1"># enable logging</span>
<span class="n">logger</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;roswire&#39;</span><span class="p">)</span>

<span class="c1"># first, we create a new ROSWire session</span>
<span class="n">rsw</span> <span class="o">=</span> <span class="n">roswire</span><span class="o">.</span><span class="n">ROSWire</span><span class="p">()</span>

<span class="c1"># we then launch a container for a given robot.</span>
<span class="c1"># once the end of the given context is reached, including the event where an</span>
<span class="c1"># exception occurs, the container will be automatically destroyed.</span>
<span class="n">image</span> <span class="o">=</span> <span class="s1">&#39;therobotcooperative/turtlebot3&#39;</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/opt/ros/kinetic/setup.bash&#39;</span><span class="p">,</span> <span class="s1">&#39;/ros_ws/devel/setup.bash&#39;</span><span class="p">]</span>
<span class="n">environment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TURTLEBOT3_MODEL&#39;</span><span class="p">:</span> <span class="s1">&#39;burger&#39;</span><span class="p">}</span>
<span class="k">with</span> <span class="n">rsw</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span> <span class="k">as</span> <span class="n">system</span><span class="p">:</span>

    <span class="c1"># we then launch ROS inside the container</span>
    <span class="c1"># again, once the end of the context is reached, ROS is killed.</span>
    <span class="k">with</span> <span class="n">system</span><span class="o">.</span><span class="n">roscore</span><span class="p">()</span> <span class="k">as</span> <span class="n">ros</span><span class="p">:</span>

        <span class="c1"># let&#39;s bring up the application</span>
        <span class="n">ros</span><span class="o">.</span><span class="n">roslaunch</span><span class="p">(</span><span class="s1">&#39;turtlebot3_house.launch&#39;</span><span class="p">,</span>
                      <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlebot3_gazebo&#39;</span><span class="p">,</span>
                      <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gui&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">})</span>

        <span class="c1"># we need to wait for the nodes to finish their initialisation</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># get an overview of the system state</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">state</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;System state: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># get topic types</span>
        <span class="n">topic_to_type</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">topic_to_type</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Topic to type: </span><span class="si">{</span><span class="n">topic_to_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rosnodes:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ros</span><span class="o">.</span><span class="n">nodes_ros2</span><span class="p">())</span>
        <span class="c1"># get service formats</span>
        <span class="n">service_to_format</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">service_name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span>
            <span class="n">service_to_format</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">name</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Service to format: </span><span class="si">{</span><span class="n">service_to_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="roswire"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">roswire 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2020, Christopher Steven Timperley.
    </div>
  </body>
</html>